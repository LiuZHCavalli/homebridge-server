<script type="text/javascript" src="/js/plugins.js"></script>

<div class='container'>
    <h2>Installed Plugins</h2>
    <div class="responsive-wrapper">
        <div class="row header" id="installedPluginsTableHeader">
            <div><span style='font-size: larger;'>&#x2139;</span></div>
            <div>Name</div>
            <div>Author</div>
            <div>Description</div>
            <div>Usage</div>
        </div>
        <div id="installedPluginsTable">
          <script>
              listInstalledPlugins();
          </script>
        </div>
    </div>

    <h2>Search for plugins</h2>
    <div class='input-group' style='width:100%;'>
        <input type='search' class='form-control' name='searchQuery' id='queryInput' placeholder="Enter search term..."/><br>
        <script>
            $("#queryInput").keyup(function(event) {
                $("#searchedPluginsTableHeader").hide();
                $("#searchedPluginsTable").empty();
                var query = $("#queryInput").val();
                if (query.length > 2) {
                    $.getJSON( "/api/searchPlugins?" + query, function( data ) {
                        if (data.length === 0) {
                            $("#searchedPluginsTable").text("No plugins found.");
                        } else {
                            $("#searchedPluginsTableHeader").show();
                            $("#searchedPluginsTable").empty();
                            var buttonStyle = "style='height: 34px; line-height: 16px; vertical-align:middle;outline:none !important;'";
                            $.each( data, function( id_plugin, plugin ) {
                                var versionInfo = "Version: " + plugin.package.version + ", updated: " + moment(plugin.package.date).fromNow();
                                var info = plugin.package.version
                                var action = "<a href='#' class='btn btn-success center-block' " + buttonStyle + " onclick='callPluginOperation(\"" + plugin.package.name + "@" + plugin.package.version + "\", \"install\");'><span style='font-size:25px;''>Install</span></a>";
                                if (plugin.hb_IsInstalled === 1) {
                                    action = "<span style='font-size:20px; align: center;''>Already installed</span>";
                                }
                                // if (homebridgeVersion < homebridgeMinVersion) {
                                //     action = "This plugin needs at least version " + homebridgeMinVersion;
                                // }
                                var row = "<div class='row content' title='" + versionInfo + "'> \
                                                <div></div> \
                                                <div><a href='" + plugin.package.links.homepage + "' target=_blank>" + plugin.package.name + "</a></div> \
                                                <div>" + plugin.package.publisher.username + "</div> \
                                                <div>" + plugin.package.description + "</div> \
                                                <div>" + action + "</div> \
                                           </div>";
                                $("#searchedPluginsTable").append(row);
                            });
                        }
                    });
                }
            });
        </script>
    </div>
    <div class="responsive-wrapper">
        <div class="row header" id="searchedPluginsTableHeader">
            <div><span style='font-size: larger;'>&#x2139;</span></div>
            <div>Name</div>
            <div>Author</div>
            <div>Description</div>
            <div>Usage</div>
        </div>
        <div id="searchedPluginsTable">
          <script>
              $("#searchedPluginsTableHeader").hide();
          </script>
        </div>
    </div>
</div>


<div class="modal" tabindex="-1" role="dialog" id="progressModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="progressModalTitle"></h4>
            </div>
            <div class="modal-body">
                <textarea id="progressModalLogContainer" rows="10" cols="50"></textarea>
            </div>
            <div class="modal-footer">
                <div id="progressModalStatus" style="float: left;"></div>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
